<html>
<head>
<title>Homework: OS Bugs</title>
</head>
<body>

<style>
TABLE.note {
  width: 60%;
  align: center;
  padding: .5em .5em .5em .5em;
  display: block;
  margin-left: auto;
  margin-right: auto;
  background: #ffffaa;
  border: 1px solid #eeee99;
}

TABLE.exercise {
  width: 50%;
  align: center;
  padding: .5em .5em .5em .5em;
  display: block;
  margin-left: auto;
  margin-right: auto;
  background: #e0e0ff;
  border: 1px solid #c0c0ff;
}
</style>

<h1>Homework: OS Bugs</h1>

<p>
<b>Read</b>: <a href="../readings/engler01deviant.pdf">Bugs as Deviant Behavior</a> by Engler et al.

<p>
<b>Hand-In Procedure</b>
<p>
You are to turn in this homework during lecture. Please write up your
answers to the exercises below and hand them in to a 6.828 staff
member at the beginning of lecture.

<p>
<b>OS Invariants</b>

<p>
Operating system code must obey many rules for correctness and
performance (e.g. check user pointers before using them in kernel
mode). These rules aren't normally checked by compilers like
<tt>gcc</tt> and Engler et al make an argument for using a
meta-compiler to check the source code for system-specific rule
violations.

<p>
Think about your JOS implementation. What are some unstated invariants
in the JOS kernel?

<p>
Here are some simple invariants that should generally be true across
all our implementations:

<p>
<table class="note"><tr><td> 
<ul>
<li>Interrupts are disabled in kernel mode.

<li>All registers are saved and restored on a context switch.

<li>Application code is never executed with CPL 0.

<li>Never write to a page on the free page list.

<li>If a page is on the free list, it is not mapped in any environment's address space below <tt>KERNBASE</tt>.

<li><tt>UENVS</tt>, <tt>UPAGES</tt> and
<tt>UVPT</tt> are never mapped writable in any address space.

<li>There is only one <tt>GDT</tt> and only one <tt>TSS</tt>.
</ul>
</table>

<p>
There are a large number of other invariants and rules that you could
probably state about your specific JOS implementation.

<p>
<table class="exercise"><tr><td> 
<b>Question</b> Have you encountered any nasty bugs that would have
been avoided if a metacompiler had alerted you that you were violating
some rule or invariant you assumed your code was obeying?

<p>
<font style="color:#6060aa">[feel free to recount mind-numbing
debugging marathons here]</font>

</table>

<p>
<b>This completes the homework.</b>

<p>
<b>In fact, this completes all homeworks!</b>

</body>
